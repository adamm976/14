<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Straight Pool 14.1 Scoreboard</title>
<style>
:root {
    --bg:#0e1117;
    --panel:#161b22;
    --blue:#4da3ff;
    --red:#ff4d4d;
    --btn:#222;
    --btn-hover:#333;
    --table-bg:#1a1f28;
}
body {
    margin:0;
    background:var(--bg);
    color:white;
    font-family:Arial, sans-serif;
    display:flex;
    flex-direction:column;
    min-height:100vh;
}
.top-container {
    display:flex;
    gap:20px;
    padding:20px;
    flex:1;
}
.left-panel {
    flex:2;
    display:flex;
    flex-direction:column;
    gap:20px;
}
.right-panel {
    flex:1;
    max-width:350px;
    overflow-x:auto;
}
.scoreboard {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:20px;
}
.player {
    background:var(--panel);
    border-radius:16px;
    padding:20px;
    display:flex;
    flex-direction:column;
    cursor:pointer;
}
.player.active { outline:4px solid white; }
.score {
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(120px, 20vw, 420px);
    font-weight:bold;
}
.p1 { color:var(--blue); }
.p2 { color:var(--red); }
.info { text-align:center; font-size:18px; opacity:0.9; }
.panel {
    background:var(--panel);
    padding:16px;
    border-radius:12px;
}
.grid {
    display:grid;
    grid-template-columns:repeat(5, 1fr);
    gap:10px;
}
button {
    background:var(--btn);
    color:white;
    border:none;
    border-radius:10px;
    padding:14px 0;
    font-size:20px;
    cursor:pointer;
}
button:hover { background:var(--btn-hover); }
.bottom {
    display:flex;
    justify-content:center;
    gap:12px;
    flex-wrap:wrap;
    padding:10px;
    background:#000;
}
table {
    width:100%;
    border-collapse:collapse;
    background:var(--table-bg);
    border-radius:10px;
    overflow:hidden;
}
th, td {
    padding:8px;
    text-align:center;
    border-bottom:1px solid #333;
}
th { background:#222; }
td { background:#161b22; }
</style>
</head>
<body>

<div class="top-container">
    <div class="left-panel">
        <div class="scoreboard">
            <div class="player active" id="p1" onclick="switchPlayer(0)">
                <div class="score p1" id="score1">0</div>
                <div class="info" id="foul1">Fouls: 0</div>
                <div class="info" id="run1">Run: 0</div>
            </div>

            <div class="player" id="p2" onclick="switchPlayer(1)">
                <div class="score p2" id="score2">0</div>
                <div class="info" id="foul2">Fouls: 0</div>
                <div class="info" id="run2">Run: 0</div>
            </div>
        </div>

        <div class="panel">
            <div class="info" style="margin-bottom:10px">Balls left after shot</div>
            <div class="grid" id="buttons"></div>
        </div>

        <div class="bottom">
            <div class="info">Balls before shot: <strong id="ballsLeft">15</strong></div>
            <button onclick="undo()">Undo</button>
            <button onclick="resetGame()">Reset</button>
            <button onclick="foul()">Foul</button>
        </div>
    </div>

    <div class="right-panel">
        <table>
            <thead>
                <tr>
                    <th>P1 Inning</th>
                    <th>P1 Sum</th>
                    <th>P2 Inning</th>
                    <th>P2 Sum</th>
                    <th>Balls Left</th>
                </tr>
            </thead>
            <tbody id="inningsTable"></tbody>
        </table>
    </div>
</div>

<script>
let state = {
    scores: [0,0],
    ballsOnTable: 15,
    current: 0,
    fouls: [0,0],
    history: [],
    run: 0,
    currentInning: [[],[]],
    completedInnings: []
};

function snapshot() {
    const snapshot = {
        scores: [...state.scores],
        ballsOnTable: state.ballsOnTable,
        current: state.current,
        fouls: [...state.fouls],
        run: state.run,
        currentInning: [ [...state.currentInning[0]], [...state.currentInning[1]] ]
    };
    state.history.push(snapshot);
    if(state.history.length > 50) state.history.shift();
}

function undo() {
    if(!state.history.length) return;
    const prev = state.history.pop();
    state.scores = prev.scores;
    state.ballsOnTable = prev.ballsOnTable;
    state.current = prev.current;
    state.fouls = prev.fouls;
    state.run = prev.run;
    state.currentInning = prev.currentInning;
    render();
}

function render() {
    score1.textContent = state.scores[0];
    score2.textContent = state.scores[1];
    ballsLeft.textContent = state.ballsOnTable;
    document.getElementById('foul1').textContent = 'Fouls: ' + state.fouls[0];
    document.getElementById('foul2').textContent = 'Fouls: ' + state.fouls[1];
    document.getElementById('run1').textContent = 'Run: ' + (state.current===0?state.run:0);
    document.getElementById('run2').textContent = 'Run: ' + (state.current===1?state.run:0);

    p1.classList.toggle("active", state.current===0);
    p2.classList.toggle("active", state.current===1);

    renderButtons();
    renderInningsTable();
}

function renderButtons() {
    const container = document.getElementById("buttons");
    container.innerHTML = "";
    const max = Math.min(15,state.ballsOnTable);
    for(let i=1;i<=max;i++){
        const b = document.createElement("button");
        b.textContent = i;
        b.onclick = ()=>handleSelection(i);
        container.appendChild(b);
    }
}

function handleSelection(selected){
    snapshot();
    const p = state.current;
    state.fouls[p]=0;
    let points=0;

    if(selected===1){
        points = state.ballsOnTable-1;
        state.run+=points;
        state.ballsOnTable=15;
        flashRack(p);
        state.currentInning[p].push(points);
        state.scores[p]+=points;
        render();
        return;
    }

    points = state.ballsOnTable - selected;
    state.ballsOnTable = selected;
    state.run = 0;

    state.currentInning[p].push(points);
    state.scores[p]+=points;

    // finalize inning if points scored
    if(points>0) finalizeInning();

    // switch player
    state.current = 1-p;

    render();
}

function finalizeInning(){
    const hasPoints = state.currentInning[0].length>0 || state.currentInning[1].length>0;
    if(!hasPoints) return;

    const row = [
        state.currentInning[0].slice(), sumArray(state.currentInning[0]),
        state.currentInning[1].slice(), sumArray(state.currentInning[1]),
        state.ballsOnTable
    ];
    state.completedInnings.push(row);
    state.currentInning = [[],[]];
}

function flashRack(player){
    const el = player===0?p1:p2;
    el.style.boxShadow='0 0 40px 10px gold';
    setTimeout(()=>{el.style.boxShadow='';},800);
}

function switchPlayer(p){
    snapshot();
    // only finalize inning if points exist
    finalizeInning();
    state.current=p;
    state.run=0;
    render();
}

function foul(){
    snapshot();
    const p = state.current;
    state.fouls[p]++;
    state.run=0;
    let points=-1;

    if(state.fouls[p]===3){
        points=-15;
        state.fouls[p]=0;
        state.ballsOnTable=15;
    } else if(state.ballsOnTable===1){
        state.ballsOnTable=15;
    }

    state.scores[p]+=points;
    state.currentInning[p].push(points);
    state.current=1-p;
    finalizeInning();
    render();
}

function sumArray(arr){return arr.reduce((a,b)=>a+b,0);}

function renderInningsTable(){
    const tbody=document.getElementById('inningsTable');
    tbody.innerHTML='';
    state.completedInnings.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${r[0].join('/')}</td>
                        <td>${r[1]}</td>
                        <td>${r[2].join('/')}</td>
                        <td>${r[3]}</td>
                        <td>${r[4]}</td>`;
        tbody.appendChild(tr);
    });
}


function resetGame(){
    if(!confirm("Reset game?")) return;
    state={
        scores:[0,0],
        ballsOnTable:15,
        current:0,
        fouls:[0,0],
        history:[],
        run:0,
        currentInning:[[],[]],
        completedInnings:[]
    };
    render();
}

render();
</script>
</body>
</html>
